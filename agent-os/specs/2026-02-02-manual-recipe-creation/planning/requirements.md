# Spec Requirements: Manual Recipe Creation

## Initial Description

Build recipe creation form allowing users to manually enter recipe title, ingredients list, and step-by-step instructions. Recipes save to user's account in Convex.

**Source:** Product Roadmap - Week 1: Foundation and Core Flow (Feature #3)
**Effort Estimate:** Small (S) - 2-3 days
**Priority:** High - Core functionality for recipe management

## Requirements Discussion

### First Round Questions

**Q1:** I assume the minimum required fields are title, at least one ingredient, and at least one instruction step -- with servings, prep time, cook time, and notes being optional. Is that correct, or should some of those optional fields be required?
**Answer:** Yes - title, at least 1 ingredient, at least 1 instruction. Servings, prep/cook time, notes are optional.

**Q2:** Looking at your existing Ingredient type (name, quantity, unit, category), I'm thinking we keep the form simple by only requiring the ingredient name for MVP, making quantity, unit, and category optional (users can type "2 cups flour" in the name field). Should we enforce structured ingredient entry instead, or is freeform acceptable for the hackathon timeline?
**Answer:** Enforced structured entry (separate fields for quantity, unit, name, category).

**Q3:** For instructions, I assume users add one step at a time with a simple text input and "Add Step" button, allowing reordering and deletion. Should we support bulk paste (detecting numbered steps and splitting automatically), or keep it step-by-step only?
**Answer:** Support bulk paste with auto-detection of numbered steps.

**Q4:** I assume recipe images are optional for manually created recipes, with a placeholder shown if no image is provided. The user can add an image via camera or photo gallery. Is that correct, or should we prompt/encourage image addition more strongly?
**Answer:** Placeholder generated by Gemini (AI-generated placeholder image based on recipe). User can add image via camera or gallery.

**Q5:** I'm thinking the form opens as a full-screen modal (consistent with mobile form patterns) that slides up from the AddRecipeMenu's "Manual Entry" option. After saving, the user returns to the recipe list. Should the form instead navigate to the new recipe's detail view after save?
**Answer:** Navigate to new recipe's detail view after save.

**Q6:** Should we include a "Save as Draft" feature for partially completed recipes, or is it save-and-done only for MVP?
**Answer:** Save and done only for MVP (no draft feature).

**Q7:** For the servings field, I assume we accept any positive integer (1-99). Should we allow decimal servings (like 1.5) or half portions?
**Answer:** Positive integers only (1-99).

**Q8:** Is there anything that should be explicitly excluded from this feature's scope -- for example, nutrition calculation, dietary tags, or cuisine type selection?
**Answer:** No - include ALL fields during creation (nutrition, dietary tags, cuisine type, difficulty).

### Existing Code to Reference

No similar existing features identified for reference by the user. However, the following product-plan components provide relevant patterns:

- **AddRecipeMenu:** `/Users/tarikmoody/Documents/Projects/digero/product-plan/sections/recipe-library/components/AddRecipeMenu.tsx` - Entry point with `onManualEntry` callback
- **RecipeDetail:** `/Users/tarikmoody/Documents/Projects/digero/product-plan/sections/recipe-library/components/RecipeDetail.tsx` - Target view after save
- **Types:** `/Users/tarikmoody/Documents/Projects/digero/product-plan/sections/recipe-library/types.ts` - Recipe and Ingredient interfaces
- **Sample Data:** `/Users/tarikmoody/Documents/Projects/digero/product-plan/sections/recipe-library/data.json` - Example recipes including `source: 'manual'`

### Follow-up Questions

No follow-up questions were needed.

## Visual Assets

### Files Provided:
No visual assets provided.

### Visual Insights:
N/A - No mockups or wireframes available. Implementation should follow existing app patterns and the RecipeDetail component styling.

## Requirements Summary

### Functional Requirements

**Form Fields (Full Form):**
- **Title** (required): Text input for recipe name
- **Image** (optional): Camera capture or gallery selection; AI-generated placeholder via Gemini if not provided
- **Ingredients** (required, min 1): Structured entry with separate fields:
  - Quantity: Number input
  - Unit: Dropdown or text input (cup, tbsp, tsp, oz, lb, piece, etc.)
  - Name: Text input for ingredient name
  - Category: Dropdown (meat, produce, dairy, pantry, spices, condiments, bread, other)
- **Instructions** (required, min 1): Text areas for step-by-step instructions
  - Support bulk paste with auto-detection of numbered steps
  - Allow reordering and deletion of individual steps
- **Servings** (optional): Integer input (1-99)
- **Prep Time** (optional): Integer input in minutes
- **Cook Time** (optional): Integer input in minutes
- **Notes** (optional): Multi-line text input
- **Cuisine Type** (optional): Selection/input for cuisine category
- **Difficulty** (optional): Selection (easy, medium, hard)
- **Dietary Tags** (optional): Multi-select (vegetarian, vegan, gluten-free, dairy-free, etc.)
- **Nutrition** (optional): Structured input for calories, protein, carbs, fat

**Bulk Paste Parsing Logic:**
The instructions bulk paste feature should detect and split numbered steps using the following patterns:
- Numbered with period: `1. Step one` `2. Step two`
- Numbered with parenthesis: `1) Step one` `2) Step two`
- Numbered with colon: `1: Step one` `2: Step two`
- Line breaks between steps (fallback if no numbering detected)

Implementation approach:
1. Detect if pasted text contains numbered patterns
2. Split text at number boundaries using regex: `/(?:^|\n)\s*\d+[\.\)\:]\s*/`
3. Filter out empty strings
4. Create individual instruction entries from each split segment
5. If no numbered pattern detected, split on double newlines as fallback
6. Allow user to review and edit split results before confirming

**AI Placeholder Image Generation:**
When user saves a recipe without providing an image:
1. Call Convex serverless function with recipe title and key ingredients
2. Function calls Gemini API to generate a food-appropriate placeholder image
3. Store generated image in Convex file storage
4. Associate imageUrl with the saved recipe
5. User can later replace with their own photo

Gemini prompt should include:
- Recipe title
- Main ingredients (first 3-5)
- Request for appetizing, realistic food photography style

**User Actions:**
- Add/remove ingredient rows
- Reorder ingredients (drag or up/down buttons)
- Add instruction steps one at a time
- Bulk paste instructions with auto-split
- Reorder instruction steps
- Delete instruction steps
- Capture image from camera
- Select image from photo gallery
- Save recipe (validates required fields)
- Cancel/close form (with confirmation if data entered)

**Data Persistence:**
- Recipe saves to Convex with `source: 'manual'`
- `sourceUrl` and `youtubeVideoId` set to `null` for manual recipes
- `createdAt` timestamp auto-generated
- Recipe associated with authenticated user's account

**Navigation Flow:**
1. User taps FAB (+) button on Recipe List
2. AddRecipeMenu appears
3. User selects "Manual Entry"
4. Full-screen recipe creation form slides up
5. User fills in recipe details
6. User taps "Save Recipe"
7. Form validates required fields
8. If valid: save to Convex, generate AI placeholder if no image, navigate to RecipeDetail view
9. If invalid: show validation errors inline

### Reusability Opportunities

Based on existing product-plan components:
- **Ingredient type structure** from `types.ts` - use exact interface
- **Recipe interface** from `types.ts` - ensure form output matches schema
- **Category options** from Ingredient type: 'meat' | 'produce' | 'dairy' | 'pantry' | 'spices' | 'condiments' | 'bread' | 'other'
- **RecipeDetail component** - navigation target after save
- **AddRecipeMenu** - entry point already has `onManualEntry` prop defined

### Scope Boundaries

**In Scope:**
- Full recipe creation form with all fields
- Structured ingredient entry (quantity, unit, name, category)
- Instruction entry with bulk paste and auto-split
- Image capture via camera
- Image selection from gallery
- AI-generated placeholder images via Gemini
- Form validation for required fields
- Save to Convex with user association
- Navigation to RecipeDetail after save
- Nutrition fields (manual entry, not auto-calculated)
- Dietary tags selection
- Cuisine type selection
- Difficulty selection

**Out of Scope:**
- Draft/auto-save functionality
- Recipe duplication/cloning
- Import from other sources (handled by separate features)
- Automatic nutrition calculation (user manually enters if desired)
- Recipe sharing
- Recipe editing (separate feature)
- Offline support

### Technical Considerations

**Tech Stack:**
- React Native with Expo
- Convex for backend and data storage
- Clerk for user authentication
- Gemini API for placeholder image generation

**Integration Points:**
- Convex mutation for creating recipes
- Convex file storage for images
- Gemini API (via Convex serverless function) for AI placeholder generation
- expo-camera for camera capture
- expo-image-picker for gallery selection

**Existing System Constraints:**
- Recipe must conform to existing Recipe interface in `types.ts`
- Ingredient must conform to existing Ingredient interface
- Image storage uses Convex file storage (existing pattern)
- User association via Clerk auth token

**Form Validation Rules:**
- Title: Required, non-empty string, max 200 characters
- Ingredients: At least 1 ingredient with non-empty name
- Instructions: At least 1 instruction with non-empty text
- Servings: Optional, if provided must be integer 1-99
- Prep Time: Optional, if provided must be positive integer (minutes)
- Cook Time: Optional, if provided must be positive integer (minutes)
- Nutrition values: Optional, if provided must be non-negative numbers

**Performance Considerations:**
- Lazy load camera/image picker modules
- Debounce validation on text inputs
- AI placeholder generation is async (show loading state, don't block navigation)
- Consider optimistic UI update on save
